--// Dev Console Log Recorder
--// /c chat toggle
--// Starts hidden
--// Inject notify added
--// Enum alignment bug fixed permanently

-- Services
local Players = game:GetService("Players")
local LogService = game:GetService("LogService")
local UIS = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local LP = Players.LocalPlayer

-- Config
local MAX_LOGS = 100
local CHAT_COMMAND = "/c"

-- State
local loggingEnabled = true
local logs = {}

-- NOTIFY (ON INJECT)
pcall(function()
    StarterGui:SetCore("SendNotification", {
        Title = "Mobile Console Loaded",
        Text = "Type /c to open and Close",
        Duration = 5
    })
end)

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "LogRecorderGUI"
gui.ResetOnSpawn = false
gui.Parent = LP:WaitForChild("PlayerGui")

local main = Instance.new("Frame")
main.Size = UDim2.fromScale(0.48, 0.48)
main.Position = UDim2.fromScale(0.26, 0.26)
main.BackgroundColor3 = Color3.fromRGB(20,20,20)
main.BorderSizePixel = 0
main.Visible = false -- START HIDDEN
main.Parent = gui
Instance.new("UICorner", main).CornerRadius = UDim.new(0,10)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,-10,0,34)
title.Position = UDim2.new(0,5,0,5)
title.BackgroundTransparency = 1
title.Text = "Dev Console Log Recorder  |  /c"
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextColor3 = Color3.new(1,1,1)
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextYAlignment = Enum.TextYAlignment.Center
title.Parent = main

-- Button factory
local function makeBtn(text, x)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0,130,0,28)
    b.Position = UDim2.new(0,x,0,44)
    b.Text = text
    b.Font = Enum.Font.Gotham
    b.TextSize = 12
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(35,35,35)
    b.BorderSizePixel = 0
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
    b.Parent = main
    return b
end

-- Buttons
local toggleBtn = makeBtn("Stop Logging", 5)
local clearBtn  = makeBtn("Clear Logs", 145)
local saveBtn   = makeBtn("Save to File", 285)
local copyBtn   = makeBtn("Copy Logs", 425)

-- Log frame
local logFrame = Instance.new("ScrollingFrame")
logFrame.Position = UDim2.new(0,5,0,80)
logFrame.Size = UDim2.new(1,-10,1,-85)
logFrame.CanvasSize = UDim2.new(0,0,0,0)
logFrame.ScrollBarImageTransparency = 0.25
logFrame.BackgroundColor3 = Color3.fromRGB(15,15,15)
logFrame.BorderSizePixel = 0
logFrame.Parent = main
Instance.new("UICorner", logFrame).CornerRadius = UDim.new(0,6)

local layout = Instance.new("UIListLayout", logFrame)
layout.Padding = UDim.new(0,4)

-- Log writer
local function pushLog(text, msgType)
    if not loggingEnabled then return end

    if #logs >= MAX_LOGS then
        table.remove(logs,1)
        for _,v in ipairs(logFrame:GetChildren()) do
            if v:IsA("TextLabel") then
                v:Destroy()
                break
            end
        end
    end

    table.insert(logs, text)

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1,-8,0,18)
    lbl.AutomaticSize = Enum.AutomaticSize.Y
    lbl.TextWrapped = true
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.TextYAlignment = Enum.TextYAlignment.Top
    lbl.BackgroundTransparency = 1
    lbl.Font = Enum.Font.Code
    lbl.TextSize = 12

    if msgType == Enum.MessageType.MessageError then
        lbl.TextColor3 = Color3.fromRGB(255,90,90)
    elseif msgType == Enum.MessageType.MessageWarning then
        lbl.TextColor3 = Color3.fromRGB(255,210,90)
    else
        lbl.TextColor3 = Color3.fromRGB(210,210,210)
    end

    lbl.Text = text
    lbl.Parent = logFrame

    task.wait()
    logFrame.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 6)
    logFrame.CanvasPosition = Vector2.new(
        0,
        math.max(0, logFrame.CanvasSize.Y.Offset - logFrame.AbsoluteWindowSize.Y)
    )
end

-- Load existing logs
for _,entry in ipairs(LogService:GetLogHistory()) do
    pushLog(os.date("[%H:%M:%S] ") .. entry.message, entry.messageType)
end

-- Real-time logs
LogService.MessageOut:Connect(function(msg, msgType)
    pushLog(os.date("[%H:%M:%S] ") .. msg, msgType)
end)

-- Buttons logic
toggleBtn.MouseButton1Click:Connect(function()
    loggingEnabled = not loggingEnabled
    toggleBtn.Text = loggingEnabled and "Stop Logging" or "Start Logging"
end)

clearBtn.MouseButton1Click:Connect(function()
    table.clear(logs)
    for _,v in ipairs(logFrame:GetChildren()) do
        if v:IsA("TextLabel") then v:Destroy() end
    end
    logFrame.CanvasSize = UDim2.new(0,0,0,0)
end)

saveBtn.MouseButton1Click:Connect(function()
    if not writefile then
        pushLog("[ERROR] writefile yok (executor gerekli)", Enum.MessageType.MessageError)
        return
    end
    local name = "DevConsoleLogs_" .. os.time() .. ".txt"
    writefile(name, table.concat(logs, "\n"))
    pushLog("[INFO] Loglar kaydedildi: "..name, Enum.MessageType.MessageOutput)
end)

copyBtn.MouseButton1Click:Connect(function()
    if not setclipboard then
        pushLog("[ERROR] setclipboard yok (executor gerekli)", Enum.MessageType.MessageError)
        return
    end
    setclipboard(table.concat(logs, "\n"))
    pushLog("[INFO] Loglar panoya kopyalandÄ±", Enum.MessageType.MessageOutput)
end)

-- Chat toggle (/c)
LP.Chatted:Connect(function(msg)
    if msg:lower() == CHAT_COMMAND then
        main.Visible = not main.Visible
    end
end)

-- Mobile + PC drag
do
    local dragging = false
    local dragStart, startPos

    main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = main.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement
        or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            main.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

pushLog("[INFO] Injected. Type /c to open or close the console.", Enum.MessageType.MessageOutput)