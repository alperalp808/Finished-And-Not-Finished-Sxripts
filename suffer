local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer
local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local cam = workspace.CurrentCamera
local Camera = workspace.CurrentCamera
local LP = Players.LocalPlayer

local ESPFolder = Instance.new("Folder")
ESPFolder.Name = "ToolESPFolder"
ESPFolder.Parent = game:GetService("CoreGui")




getgenv().antiragdoll = false
getgenv().LoopTP = false
_G.tplayer = nil
getgenv().anahtar = false
getgenv().unlock = false
getgenv().infjump = false
getgenv().clip = false
getgenv().lip = false
getgenv().otorun = false
local UNDER_OFFSET = 5

getgenv().OnBoxESP = false 
getgenv().name = false
getgenv().Tool = false
getgenv().highlight = false
local Box_Thickness = 0
local Autothickness = true
local WHITE = Color3.fromRGB(255,255,255)
local ESP_COLOR = Color3.fromRGB(255, 255, 255)
local FILL_TRANSPARENCY = 0.5
local OUTLINE_TRANSPARENCY = 0
getgenv().antitrap = false
getgenv().antibomb = false
getgenv().antigrenade = false

local C4_RADIUS = 30        
local GRENADE_RADIUS = 18 

getgenv().LockKey = Enum.KeyCode.E
getgenv().toool = false
getgenv().FOVEnabled = false
getgenv().FOVRadius = 120
getgenv().Prediction = 0.160126357
getgenv().TargetPart = "HumanoidRootPart"
getgenv().MaxDistance = 300
getgenv().HLtarget = false
getgenv().fillColor = Color3.fromRGB(255, 0, 0)
getgenv().outlineColor = Color3.fromRGB(255, 255, 255)
getgenv().Notify = false


getgenv().otosss   = false
getgenv().hlll     = falss
getgenv().WallCh   = false

getgenv().predX    = 0.160126357
getgenv().predY    = 0.160126357
getgenv().predZ    = 0.160126357

getgenv().fovSize  = 80
getgenv().showFov  = false
getgenv().fireRate = 0

local anim = Instance.new("Animation")
anim.AnimationId = "rbxassetid://6694500885"
local track = hum:LoadAnimation(anim)

local allowedWeapons = {
        mp5a3 = true,
        pistols = true,
        sniper = true,
        deagle = true,
        minigun = true
}
local SAFE_POS = CFrame.new(1885, 220, 1235)
local savedCFrame
local returned = false

local Weapons = {
    ["axe"] = {Remote="slash1", AnimationId="rbxassetid://6633483957"},
    ["spiked club"] = {Remote="slash1", AnimationId="rbxassetid://6974203286"},
    ["bat"] = {Remote="slash2", AnimationId="rbxassetid://6927606043"},
    ["mace"] = {Remote="slash1", AnimationId="rbxassetid://6632130962"},
    ["machete"] = {Remote="slash2", AnimationId="rbxassetid://6632130962"},
    ["pan"] = {Remote="slash1", AnimationId="rbxassetid://7025425795"},
    ["crowbar"] = {Remote="slash1", AnimationId="rbxassetid://7073120971"},
    ["dagger"] = {Remote="slash1", AnimationId="rbxassetid://7073120971"},
    ["cleavers"] = {Remote="slash1", AnimationId="rbxassetid://6627615333"},
    ["katana"] = {Remote="slash4", AnimationId="rbxassetid://6974941013"},
    ["cricket bat"] = {Remote="slash1", AnimationId="rbxassetid://6633483957"},
    ["golf club"] = {Remote="slash2", AnimationId="rbxassetid://6632130962"},
    ["electric guitar"] = {Remote="slash1", AnimationId="rbxassetid://6632130962"},
    ["chainsaw"] = {Remote="slash1", AnimationId="rbxassetid://7025071056"},
    ["cheetos"] = {Remote="slash1", AnimationId="rbxassetid://7124253040"},
    ["sabres"] = {Remote="slash1", AnimationId="rbxassetid://6931145238"}
}

function setTarget(v)
    v = string.lower(v)
    for _, p in pairs(Players:GetPlayers()) do
        if string.find(string.lower(p.Name), v, 1, true)
        or string.find(string.lower(p.DisplayName), v, 1, true) then
            _G.tplayer = p.Name
            print("Target:", p.Name)
            break
        end
    end
end

local ActiveTracks = {}
local ActiveWeapons = {} -- Hangi silah ÅŸu an aktif, animasyon oynuyor

-- Animasyon oynatma fonksiyonu
local function playAnimation(humanoid, animId, toolName)
    if ActiveTracks[toolName] and ActiveTracks[toolName].IsPlaying then
        return ActiveTracks[toolName] -- Zaten oynuyorsa tekrar baÅŸlatma
    end
    local anim = Instance.new("Animation")
    anim.AnimationId = animId
    local track = humanoid:LoadAnimation(anim)
    track.Looped = true
    track:Play()
    ActiveTracks[toolName] = track
    ActiveWeapons[toolName] = true
    return track
end

-- SilahÄ± karaktere taÅŸÄ±, saldÄ±r ve animasyon oynat
local function attackWeapon(toolName, data)
    local Char = LP.Character
    local Backpack = LP:FindFirstChild("Backpack")
    local weapon = Char:FindFirstChild(toolName) or (Backpack and Backpack:FindFirstChild(toolName))
    if weapon and weapon:FindFirstChild("RemoteEvent") then
        -- SilahÄ± karaktere taÅŸÄ±
        if weapon.Parent ~= Char then
            weapon.Parent = Char
        end
        local remote = weapon.RemoteEvent
        local hum = Char:FindFirstChildOfClass("Humanoid")
        if not hum then return end

        -- Animasyon baÅŸlat (spam Ã¶nlemeli)
        playAnimation(hum, data.AnimationId, toolName)

        -- Attack loop
        local connection
        connection = RunService.RenderStepped:Connect(function()
            if getgenv().Attacker == false or not Char or not Char:FindFirstChild(toolName) then
                -- Animasyon durdur ve silahÄ± backpack'e taÅŸÄ±
                if ActiveTracks[toolName] then
                    ActiveTracks[toolName]:Stop()
                    ActiveTracks[toolName] = nil
                end
                if weapon and weapon.Parent == Char then
                    weapon.Parent = Backpack
                end
                ActiveWeapons[toolName] = nil
                connection:Disconnect()
                return
            end
            if remote then
                remote:FireServer("attack", data.Remote)
            end
        end)
    end
end

-- Ana loop: envanteri kontrol et ve saldÄ±r
RunService.RenderStepped:Connect(function()
    if getgenv().Attacker == false then return end
    local Char = LP.Character
    local Backpack = LP:FindFirstChild("Backpack")
    if not Char then return end

    for toolName, data in pairs(Weapons) do
        if ((Backpack and Backpack:FindFirstChild(toolName)) or Char:FindFirstChild(toolName))
        and not ActiveWeapons[toolName] then
            attackWeapon(toolName, data)
        end
    end
end)

-- KullanÄ±m:
-- setTarget("OyuncuAdi")  -- senin mevcut target sisteminle


RunService.Heartbeat:Connect(function()
    if not getgenv().LoopTP then
        if savedCFrame and not returned then
            local hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.CFrame = savedCFrame
                savedCFrame = nil
                returned = true
            end
        end
        return
    end

    local char = lp.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if not savedCFrame then
        savedCFrame = hrp.CFrame
        returned = false
    end

    local target = _G.tplayer and Players:FindFirstChild(_G.tplayer)
    if not target then return end

    local thrp = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
    if not thrp then return end

    local vel = thrp.Velocity
    local flatVel = Vector3.new(vel.X, 0, vel.Z)
    local speed = flatVel.Magnitude

    local targetPos
    if speed < 2 then
        targetPos = thrp.Position - Vector3.new(0, UNDER_OFFSET, 0)
    else
        local dir = flatVel.Unit
        local dist = math.clamp(speed * 0.35, 4, 9)
        targetPos = thrp.Position + (dir * dist) - Vector3.new(0, UNDER_OFFSET, 0)
    end

    hrp.CFrame = CFrame.new(targetPos) * CFrame.Angles(math.pi / 2, 0, 0)
end)

game:GetService("UserInputService").JumpRequest:Connect(function()
        if getgenv().infjump then
                game.Players.LocalPlayer.Character.Humanoid:ChangeState("Jumping")
        end
end)

local function Notify(title, text)
        if not getgenv().Notify then return end
        pcall(function()
                StarterGui:SetCore("SendNotification", {
                        Title = title,
                        Text = text,
                        Duration = 2
                })
        end)
end

-- =====================================
-- FOV (ANDROID FIXED)
-- =====================================
local FOV = Drawing.new("Circle")
FOV.Filled = false
FOV.Thickness = 2
FOV.NumSides = 100
FOV.Color = Color3.fromRGB(255,255,255)

local FOVPos = Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y/2)

UIS.TouchStarted:Connect(function(t)
        FOVPos = Vector2.new(t.Position.X, t.Position.Y)
end)

UIS.TouchMoved:Connect(function(t)
        FOVPos = Vector2.new(t.Position.X, t.Position.Y)
end)

UIS.InputChanged:Connect(function(input)
        if not UIS.TouchEnabled and input.UserInputType == Enum.UserInputType.MouseMovement then
                FOVPos = Vector2.new(input.Position.X, input.Position.Y)
        end
end)

RunService.RenderStepped:Connect(function()
        FOV.Visible = getgenv().FOVEnabled
        if getgenv().FOVEnabled then
                FOV.Position = FOVPos
                FOV.Radius = getgenv().FOVRadius
        end
end)

-- =====================================
-- HIGHLIGHT
-- =====================================
local currentHL
local function clearHL()
        if currentHL then currentHL:Destroy() currentHL = nil end
end

local function applyHL(char)
        if not getgenv().HLtarget then return end
        clearHL()
        local hl = Instance.new("Highlight")
        hl.Adornee = char
        hl.FillColor = getgenv().fillColor
        hl.OutlineColor = getgenv().outlineColor
        hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        hl.Parent = CoreGui
        currentHL = hl
end

-- =====================================
-- TARGET BULMA
-- =====================================
local function getTarget()
        local best, bestMag = nil, math.huge
        for _, p in ipairs(Players:GetPlayers()) do
                if p ~= lp and p.Character then
                        local hum = p.Character:FindFirstChildOfClass("Humanoid")
                        local part = p.Character:FindFirstChild(getgenv().TargetPart)
                        if hum and hum.Health > 0 and part then
                                local dist = (part.Position - cam.CFrame.Position).Magnitude
                                if dist <= getgenv().MaxDistance then
                                        local sp, onScr = cam:WorldToViewportPoint(part.Position)
                                        if onScr then
                                                local mag = (Vector2.new(sp.X, sp.Y) - FOVPos).Magnitude
                                                if mag <= getgenv().FOVRadius and mag < bestMag then
                                                        bestMag = mag
                                                        best = p
                                                end
                                        end
                                end
                        end
                end
        end
        return best
end

local LockedPlayer = nil
local Locking = false

local function toggleLock()
        if Locking then
                Locking = false
                LockedPlayer = nil
                clearHL()
                Notify("Unlocked", "")
                return
        end

        local t = getTarget()
        if t and t.Character then
                LockedPlayer = t
                Locking = true
                applyHL(t.Character)
                Notify("Locked", t.Name)
        end
end

-- ðŸ”‘ KEYBIND (FINAL FIX)
UIS.InputBegan:Connect(function(input)
        if input.KeyCode == getgenv().LockKey then
                toggleLock()
        end
end)


RunService.RenderStepped:Connect(function()
        if not Locking or not LockedPlayer or not LockedPlayer.Character then return end
        local part = LockedPlayer.Character:FindFirstChild(getgenv().TargetPart)
        if not part then return end

        if (part.Position - cam.CFrame.Position).Magnitude > getgenv().MaxDistance then
                toggleLock()
                return
        end

        local pred = part.Position + (part.AssemblyLinearVelocity * getgenv().Prediction)
        cam.CFrame = CFrame.new(cam.CFrame.Position, pred)
end)

-- =====================================
-- TOOL SYSTEM
-- =====================================
local TOOL_NAME = "Locking Tool"

local function hasTool()
        return lp.Backpack:FindFirstChild(TOOL_NAME) or (lp.Character and lp.Character:FindFirstChild(TOOL_NAME))
end

local function giveTool()
        if hasTool() then return end
        local t = Instance.new("Tool")
        t.Name = TOOL_NAME
        t.RequiresHandle = false
        t.CanBeDropped = false
        t.Activated:Connect(toggleLock)
        t.Parent = lp.Backpack
end

local function removeTool()
        for _, c in ipairs({lp.Backpack, lp.Character}) do
                if c then
                        local t = c:FindFirstChild(TOOL_NAME)
                        if t then t:Destroy() end
                end
        end
end

task.spawn(function()
        while true do
                task.wait(0.4)
                if getgenv().toool then
                        giveTool()
                else
                        removeTool()
                        Locking = false
                        LockedPlayer = nil
                        clearHL()
                end
        end
end)

lp.CharacterAdded:Connect(function()
        task.wait(0.5)
        if getgenv().toool then
                giveTool()
        end
end)


local function setupCharacter(character)
        local humanoid = character:WaitForChild("Humanoid")
        RunService.Heartbeat:Connect(function()
                if not getgenv().antiragdoll then return end
                if humanoid:GetState() == Enum.HumanoidStateType.Physics then
                        humanoid.RequiresNeck = true
                        humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
                end
                StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Backpack, true)
        end)
        humanoid.HealthChanged:Connect(function()
                if getgenv().antiragdoll and humanoid:GetState() == Enum.HumanoidStateType.Physics then
                        humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
                end
        end)
end

if char then setupCharacter(char) end
lp.CharacterAdded:Connect(setupCharacter)

local function holdingAllowedWeapon()
        local char = lp.Character
        if not char then return false end
        for _, obj in ipairs(char:GetChildren()) do
                if obj:IsA("Tool") and allowedWeapons[string.lower(obj.Name)] then
                        return true
                end
        end
        return false
end

RunService.Heartbeat:Connect(function()
        if getgenv().unlock == true and holdingAllowedWeapon() then
                lp.CameraMode = Enum.CameraMode.Classic
                lp.CameraMinZoomDistance = 0
                lp.CameraMaxZoomDistance = 99
        end
end)

local dashGui = Instance.new("ScreenGui")
dashGui.Name = "DashGui"
dashGui.ResetOnSpawn = false
dashGui.Parent = game.CoreGui
local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0,80,0,35)
btn.Position = UDim2.new(0,20,0.5,-20)
btn.Text = "Flip"
btn.BackgroundColor3 = Color3.fromRGB(30,30,30)
btn.TextColor3 = Color3.new(1,1,1)
btn.Font = Enum.Font.SourceSansBold
btn.TextSize = 14
btn.Active = true
btn.Draggable = true
btn.Parent = dashGui

dashGui.Enabled = false

local function Dash()
        local char = lp.Character or lp.CharacterAdded:Wait()
        local hum = char:WaitForChild("Humanoid")
        local hrp = char:WaitForChild("HumanoidRootPart")
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://6690693371"
        local track = hum:LoadAnimation(anim)
        track:Play()

        local targetSpeed = 106
        local duration = 0.25
        local startTime = tick()
        local connection
        connection = RunService.Heartbeat:Connect(function()
                if not hrp.Parent then connection:Disconnect() return end
                local alpha = math.clamp((tick()-startTime)/duration,0,1)
                local dir = hrp.CFrame.LookVector
                local desiredVelocity = dir*targetSpeed
                hrp.AssemblyLinearVelocity = hrp.AssemblyLinearVelocity:Lerp(desiredVelocity,alpha)
                if alpha>=1 then connection:Disconnect() end
        end)
end
btn.MouseButton1Click:Connect(Dash)



local busy = false
RunService.Heartbeat:Connect(function()
        if not getgenv().anahtar or busy then return end
        local char = lp.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        local crate = Workspace:FindFirstChild("crate")
        if not crate then return end
        local handle = crate:FindFirstChild("Handle") or crate:FindFirstChild("Part") or crate:FindFirstChildWhichIsA("BasePart")
        if not handle then return end

        busy = true
        task.wait(20)
        if not getgenv().anahtar or not hrp.Parent or crate.Name ~= "crate" then
                busy = false
                return
        end

        local savedCFrame = hrp.CFrame
        hrp.CFrame = handle.CFrame * CFrame.new(0,0,-2)
        task.wait(0.25)
        for _, v in ipairs(crate:GetDescendants()) do
                if v:IsA("ProximityPrompt") and v.Enabled then
                        fireproximityprompt(v)
                        break
                end
        end
        task.wait(0.2)
        crate.Name = "CollectedCrate"
        task.wait(0.2)
        hrp.CFrame = savedCFrame
        task.wait(0.5)
        busy = false
end)

task.spawn(function()
    while true do
        task.wait(0.2) -- performans iÃ§in kÃ¼Ã§Ã¼k delay

        if not getgenv().antitrap then
            continue
        end

        local items = Workspace:FindFirstChild("items")
        if not items then
            continue
        end

        -- AynÄ± anda birden fazla "human trap" olabilir
        for _, obj in ipairs(items:GetChildren()) do
            if obj.Name == "human trap" then
                pcall(function()
                    obj:Destroy()
                end)
            end
        end
    end
end)


local savedCFrame = nil
local locked = false
local activeType = nil -- "c4" | "grenade"

-- En yakÄ±n parÃ§a bulucu (Model / Part uyumlu)
local function getClosestPart(item, hrp)
    if item:IsA("BasePart") then
        return item
    end

    if item:IsA("Model") then
        local closest
        local dist = math.huge

        for _, v in ipairs(item:GetDescendants()) do
            if v:IsA("BasePart") then
                local d = (hrp.Position - v.Position).Magnitude
                if d < dist then
                    dist = d
                    closest = v
                end
            end
        end
        return closest
    end
end

task.spawn(function()
    while task.wait(0.1) do
        local char = LocalPlayer.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then continue end

        local items = Workspace:FindFirstChild("items")
        if not items then continue end

        -- Her ÅŸey kapalÄ±ysa bÄ±rak
        if not getgenv().antibomb and not getgenv().antigrenade then
            locked = false
            savedCFrame = nil
            activeType = nil
            continue
        end

        -- Itemleri bul
        local c4 = getgenv().antibomb and (items:FindFirstChild("c4") or items:FindFirstChild("markedc4")) or nil
        local grenade = getgenv().antigrenade and (items:FindFirstChild("grenade") or items:FindFirstChild("markedgrenade")) or nil

        -- HiÃ§ tehdit yoksa geri dÃ¶n
        if not c4 and not grenade then
            if locked and savedCFrame then
                hrp.CFrame = savedCFrame
            end
            locked = false
            savedCFrame = nil
            activeType = nil
            continue
        end

        -- Aktif hedef belirleme
        local target, targetType, radius

        if activeType == "c4" and c4 then
            target, targetType, radius = c4, "c4", C4_RADIUS
        elseif activeType == "grenade" and grenade then
            target, targetType, radius = grenade, "grenade", GRENADE_RADIUS
        else
            if c4 then
                target, targetType, radius = c4, "c4", C4_RADIUS
            elseif grenade then
                target, targetType, radius = grenade, "grenade", GRENADE_RADIUS
            end
        end

        if not target then continue end

        local part = getClosestPart(target, hrp)
        if not part then continue end

        local distance = (hrp.Position - part.Position).Magnitude

        if distance <= radius then
            if not locked then
                savedCFrame = hrp.CFrame
                locked = true
                activeType = targetType

                pcall(function()
                    if targetType == "c4" then
                        target.Name = "markedc4"
                    elseif targetType == "grenade" then
                        target.Name = "markedgrenade"
                    end
                end)
            end
        end

        -- Kilitliyken gÃ¼venli noktada tut
        if locked then
            hrp.CFrame = SAFE_POS
        end
    end
end)




local circle = Drawing.new("Circle")
circle.Thickness = 2
circle.NumSides = 60
circle.Filled = false
circle.Transparency = 1

--// HIGHLIGHT
local hl = Instance.new("Highlight")
hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
hl.FillTransparency = 0.5
hl.Parent = game.CoreGui

local currentTarget = nil
local lastShot = 0

--// WALL CHECK (dinamik toggle)
local function isVisible(hrp, character)
    if not getgenv().WallCh then
        return true
    end

    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {
        LocalPlayer.Character,
        character
    }

    local result = workspace:Raycast(
        Camera.CFrame.Position,
        hrp.Position - Camera.CFrame.Position,
        params
    )

    return result == nil
end

--// TARGET FIND (FOV + wall + alive)
local function getTarget()
    local best, bestDist = nil, math.huge
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local char = plr.Character
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local hum = char:FindFirstChildOfClass("Humanoid")

            if hrp and hum and hum.Health > 0 then
                local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                if onScreen then
                    local dist = (Vector2.new(pos.X,pos.Y) - center).Magnitude

                    if dist <= (getgenv().fovSize or 0) then
                        if isVisible(hrp, char) then
                            if dist < bestDist then
                                bestDist = dist
                                best = plr
                            end
                        end
                    end
                end
            end
        end
    end

    return best
end

--// REMOTE FIND (elde / backpack dinamik)
local function getShootRemote()
    local bp = LocalPlayer:FindFirstChild("Backpack")
    local char = LocalPlayer.Character

    local gun = bp and bp:FindFirstChild("minigun")
        or char and char:FindFirstChild("minigun")

    return gun and gun:FindFirstChild("Shoot")
end

--// MAIN LOOP (her ÅŸey canlÄ± okunur)
RunService.RenderStepped:Connect(function()

    -- FOV draw dinamik
    circle.Visible = getgenv().showFov == true
    circle.Radius  = getgenv().fovSize or 0
    circle.Position = Vector2.new(
        Camera.ViewportSize.X/2,
        Camera.ViewportSize.Y/2
    )

    -- hedef bul
    local target = getTarget()

    -- highlight dinamik kontrol
    if getgenv().hlll and target and target.Character then
        if currentTarget ~= target then
            hl.Adornee = target.Character
            hl.Enabled = true
            currentTarget = target
        end
    else
        hl.Enabled = false
        hl.Adornee = nil
        currentTarget = nil
    end

    -- oto ateÅŸ kapalÄ±ysa Ã§Ä±k
    if not getgenv().otosss then return end
    if not target or not target.Character then return end

    -- fire rate dinamik
    if tick() - lastShot < (getgenv().fireRate or 0.2) then return end

    local hrp = target.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- AXIS SPLIT PRED (menÃ¼ slider canlÄ± okur)
    local v = hrp.Velocity
    local p = hrp.Position

    local predicted = Vector3.new(
        p.X + v.X * (getgenv().predX or 0),
        p.Y + v.Y * (getgenv().predY or 0),
        p.Z + v.Z * (getgenv().predZ or 0)
    )

    local remote = getShootRemote()
    if remote then
        lastShot = tick()
        remote:FireServer(predicted)
    end
end)

--// WINDUI LOADSTRING
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

--// THEME
WindUI:AddTheme({
    Name = "My Theme",
    Accent = Color3.fromHex("#18181b"),
    Background = Color3.fromHex("#101010"),
    Outline = Color3.fromHex("#FFFFFF"),
    Text = Color3.fromHex("#FFFFFF"),
    Placeholder = Color3.fromHex("#7a7a7a"),
    Button = Color3.fromHex("#52525b"),
    Icon = Color3.fromHex("#a1a1aa"),
})

--// WINDOW
local Window = WindUI:CreateWindow({
    Title = "Sigeon Pex | Suffer Script |",
    Icon = "door-open",
    Folder = "l",
    Size = UDim2.fromOffset(580, 460),
    MinSize = Vector2.new(360, 150),
    MaxSize = Vector2.new(850, 560),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
    SideBarWidth = 200,
    HideSearchBar = true,
    ScrollBarEnabled = false,
})

--// TABS
local Target   = Window:Tab({ Title = "Target", Icon = "crosshair" })
local MT   = Window:Tab({ Title = "Multi Target", Icon = "crosshair" })
local Self     = Window:Tab({ Title = "Self", Icon = "user" })
local Mods     = Window:Tab({ Title = "Mods", Icon = "settings" })
local Aiming   = Window:Tab({ Title = "CamLock", Icon = "target" })
local Silent   = Window:Tab({ Title = "Minigun Silent Aim", Icon = "target" })
local Visual   = Window:Tab({ Title = "Visual", Icon = "eye" })
local Starting = Window:Tab({ Title = "Starting", Icon = "play" })
local Teleport = Window:Tab({ Title = "Teleport", Icon = "map-pin" })

--// ================= TARGET =================
Target:Input({
    Title = "Select Target",
    Placeholder = "Player Name",
    Callback = function(state)
      setTarget(state)
    end
})


getgenv().Spectate = false
local spectateConnection

Target:Toggle({
    Title = "View Target",
    Value = false,
    Callback = function(t) 
              getgenv().Spectate = t

        if spectateConnection then
            spectateConnection:Disconnect()
            spectateConnection = nil
        end

        if t and _G.tplayer then
            spectateConnection = RunService.Heartbeat:Connect(function()
                local targetPlayer = Players:FindFirstChild(_G.tplayer)
                if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("Humanoid") then
                    workspace.CurrentCamera.CameraSubject = targetPlayer.Character
                else
                    -- EÄŸer target yoksa LocalPlayer'e dÃ¶n
                    workspace.CurrentCamera.CameraSubject = lp.Character
                end
            end)
        else
            workspace.CurrentCamera.CameraSubject = lp.Character
        end
    end
})

Target:Toggle({
    Title = "Kill Target",
    Value = false,
    Callback = function(state) 
      getgenv().LoopTP = state
      getgenv().Attacker = state
    end
})

Target:Slider({
    Title = "Underground Offset",
    Value = { Min = 0, Max = 10, Default = 5 },
    Callback = function(state) 
      UNDER_OFFSET = state
    end
})

Target:Button({
    Title = "Bring Target",
    Callback = function() 
                  local targetPlayer = Players:FindFirstChild(_G.tplayer)
if targetPlayer then
    local targetChar = targetPlayer.Character
    local targetHumanoid = targetChar and targetChar:FindFirstChild("Humanoid")
    if targetHumanoid and targetHumanoid.Health >= 1 and targetHumanoid.Health <= 20 then
        ReplicatedStorage.RadollHoldingFunction:InvokeServer(targetPlayer)
        local localChar = Players.LocalPlayer.Character
        local humanoidRoot = localChar and localChar:FindFirstChild("HumanoidRootPart")
        if humanoidRoot then
            humanoidRoot.Anchored = true
            wait(2)
            ReplicatedStorage.RagdollServer:FireServer("dropRagdoll")
            humanoidRoot.Anchored = false
        end
    else
        warn("Target can deÄŸeri 1-20 arasÄ±nda deÄŸil!")
    end
else
    warn("TargetPlayer bulunamadÄ±!")
end
    end
})

Target:Button({
    Title = "Goto Target",
    Callback = function() 
      local targetPlayer = Players:FindFirstChild(_G.tplayer)
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame
    end
})


-------------------------------------------------
-- SERVICES
-------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-------------------------------------------------
-- GLOBAL TARGETLER
-------------------------------------------------
getgenv().Sigma_Target = nil
getgenv().ligma_Target = nil
getgenv().Mogger_Targed = nil
getgenv().sixseven_target = nil
getgenv().ohio_target = nil

-------------------------------------------------
-- TARGET + TOGGLE DATA
-------------------------------------------------
local TargetData = {
    Sigma = { key="Sigma_Target", toggles={Deagle=false, Minigun=false, Shotgun=false, MP5=false} },
    Ligma = { key="ligma_Target", toggles={Deagle=false, Minigun=false, Shotgun=false, MP5=false} },
    Mogger = { key="Mogger_Targed", toggles={Deagle=false, Minigun=false, Shotgun=false, MP5=false} },
    SixSeven = { key="sixseven_target", toggles={Deagle=false, Minigun=false, Shotgun=false, MP5=false} },
    Ohio = { key="ohio_target", toggles={Deagle=false, Minigun=false, Shotgun=false, MP5=false} }
}

local Dropdowns = {}

-------------------------------------------------
-- PLAYER LIST
-------------------------------------------------
local function GetPlayerList()
    local list = {}
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            table.insert(list, plr.Name)
        end
    end
    return list
end

-------------------------------------------------
-- TARGET PLAYER ALMA
-------------------------------------------------
local function GetTargetPlayer(targetKey)
    local name = getgenv()[targetKey]
    if type(name) ~= "string" then return nil end

    local plr = Players:FindFirstChild(name)
    if not plr or plr == LocalPlayer then return nil end
    return plr
end

-------------------------------------------------
-- ðŸ”« ORTAK ATEÅž FONKSÄ°YONLARI
-------------------------------------------------
local function FireWeapon(targetKey, weaponName)
    local target = GetTargetPlayer(targetKey)
    if not target then return end

    local char = target.Character
    if not char then return end

    local weapon = char:FindFirstChild(weaponName)
    if not weapon then return end

    local shoot = weapon:FindFirstChild("Shoot")
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not shoot or not hrp then return end

    shoot:FireServer(hrp.Position)
end

local function FireMP5(targetKey)
    local target = GetTargetPlayer(targetKey)
    if not target then return end

    local char = target.Character
    if not char then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local targetModel = workspace:FindFirstChild(target.Name)
    if not targetModel then return end

    local mp5 = targetModel:FindFirstChild("mp5a3")
    if not mp5 then return end

    local shoot = mp5:FindFirstChild("Shoot")
    if not shoot then return end

    shoot:FireServer(hrp.Position)
end

-------------------------------------------------
-- ðŸš€ RUNSERVICE LOOP
-------------------------------------------------
RunService.Stepped:Connect(function()
    for _, data in pairs(TargetData) do
        local key = data.key
        local t = data.toggles

        if t.Deagle then FireWeapon(key, "deagle") end
        if t.Minigun then FireWeapon(key, "minigun") end
        if t.Shotgun then FireWeapon(key, "shotgun") end
        if t.MP5 then FireMP5(key) end
    end
end)

-------------------------------------------------
-- ðŸŽ¯ DROPDOWN OLUÅžTURMA (OTOMATÄ°K REFRESH YOK)
-------------------------------------------------
local function CreateTargetDropdown(title, targetKey)
    local dd = MT:Dropdown({
        Title = title,
        Desc = "Select target player",
        Values = GetPlayerList(),
        Value = nil,
        Callback = function(option)
            getgenv()[targetKey] = option
            print("[TARGET]", targetKey, "=", option)
        end
    })
    Dropdowns[targetKey] = dd
end

-------------------------------------------------
-- ðŸ”„ MANUEL REFRESH BUTONU
-------------------------------------------------
MT:Button({
    Title = "Refresh Target List",
    Callback = function()
        local list = GetPlayerList()
        for _, dd in pairs(Dropdowns) do
            dd:Refresh(list)
        end
        print("[TARGET] Dropdowns manually refreshed")
    end
})

-------------------------------------------------
-- ðŸŽ›ï¸ TOGGLE OLUÅžTURMA (HER DROPDOWN AYRI)
-------------------------------------------------
local function CreateTargetToggles(prefix, data)
    MT:Toggle({
        Title = prefix .. " - Kill With Deagle",
        Value = false,
        Callback = function(v)
            data.toggles.Deagle = v
        end
    })

    MT:Toggle({
        Title = prefix .. " - Kill With Minigun",
        Value = false,
        Callback = function(v)
            data.toggles.Minigun = v
        end
    })

    MT:Toggle({
        Title = prefix .. " - Kill With Shotgun",
        Value = false,
        Callback = function(v)
            data.toggles.Shotgun = v
        end
    })

    MT:Toggle({
        Title = prefix .. " - Kill With MP5",
        Value = false,
        Callback = function(v)
            data.toggles.MP5 = v
        end
    })
end

-------------------------------------------------
-- ðŸ“Œ DROPDOWN + TOGGLEâ€™LARI OLUÅžTUR
-------------------------------------------------
CreateTargetDropdown("Sigma Target", "Sigma_Target")
CreateTargetToggles("Sigma Target", TargetData.Sigma)

CreateTargetDropdown("Ligma Target", "ligma_Target")
CreateTargetToggles("Ligma Target", TargetData.Ligma)

CreateTargetDropdown("Mogger Target", "Mogger_Targed")
CreateTargetToggles("Mogger Target", TargetData.Mogger)

CreateTargetDropdown("SixSeven Target", "sixseven_target")
CreateTargetToggles("SixSeven Target", TargetData.SixSeven)

CreateTargetDropdown("Ohio Target", "ohio_target")
CreateTargetToggles("Ohio Target", TargetData.Ohio)



--// ================= SELF =================
Self:Slider({
    Title = "WalkSpeed",
    Value = { Min = 0, Max = 100, Default = 16 },
    Callback = function(state) 
      game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = state
    end
})

Self:Slider({
    Title = "JumpHeigh",
    Value = { Min = 0, Max = 50, Default = 7 },
    Callback = function(state) 
      game.Players.LocalPlayer.Character.Humanoid.JumpHeight = state
    end
})

Self:Toggle({ Title = "Noclip", Value = false, Callback = function(state) 
                  getgenv().clip = state
  if getgenv().clip == true then
    NoclipLoop = game:GetService("RunService").Stepped:Connect(function()
      for i,v in pairs(game.Players.LocalPlayer.Character:GetChildren()) do
        if v:IsA("BasePart") and v.CanCollide == true then
          v.CanCollide = false
        end
      end
    end)
  elseif getgenv().clip == false and NoclipLoop then
    NoclipLoop:Disconnect()
  end
end })
Self:Toggle({ Title = "Ä°nfinite Jump", Value = false, Callback = function(state) 
  getgenv().infjump = state
end })
Self:Toggle({ Title = "Anti Fling", Value = false, Callback = function(a) 
  getgenv().lip = a
if getgenv().lip == true then
NoclipLoop =
game:GetService("RunService").Stepped:Connect(
function()
for _, player in pairs(game.Players:GetPlayers()) do
if player ~= game.Players.LocalPlayer and player.Character then
for _, part in pairs(player.Character:GetChildren()) do
if part:IsA("BasePart") and part.CanCollide == true then
part.CanCollide = false
end
end
end
end
end
)
elseif getgenv().lip == false and NoclipLoop then
NoclipLoop:Disconnect()
end
end })
Self:Toggle({ Title = "Float", Value = false, Callback = function(t) 
  floattoggle = t
if floattoggle then
while wait(0.001) do
pcall(
function()
if workspace:FindFirstChild("FloatExploit") then
workspace.FloatExploit:Destroy()
end
local Float = Instance.new("Part", game.Workspace)
Float.Anchored = true
Float.Name = "FloatExploit"
Float.Transparency = 1
Float.Position =
game.Players.LocalPlayer.Character.HumanoidRootPart.Position +
Vector3.new(0, -3.1, 0)
Float.Size = Vector3.new(3, 0, 3)
end
)
if not floattoggle then
if workspace:FindFirstChild("FloatExploit") then
workspace.FloatExploit:Destroy()
end
break
end
end
end
end })

Self:Button({ Title = "No Jump Cooldown", Callback = function() 
  for _, v in next, getconnections(game.Players.LocalPlayer.Character.Humanoid.StateChanged) do
    local info = getinfo(v.Function)
    if info.what == "Lua" and info.source == "=Workspace."..game.Players.LocalPlayer.Name..".movementt" then
        v:Disable()
    end
end
end })
Self:Button({ Title = "Godmode", Callback = function() 
              game.Players.LocalPlayer.Character.Head:Destroy()
            wait(5)
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2340, 181, 1288)
            game.Players.LocalPlayer.PlayerGui.classes.Enabled = false
            game.Workspace.Camera.CameraType = "Follow"
            game.Workspace.CurrentCamera.CameraSubject = game.Players.LocalPlayer.Character
end })
Self:Button({ Title = "Anti Sit", Callback = function() 
  local function neutralizarAsiento(asiento)
        if asiento:IsA("Seat") or asiento:IsA("VehicleSeat") then
                asiento.Disabled = true
                asiento.CanTouch = false
                asiento:SetAttribute("Neutralizado", true)
        end
end
for _, objeto in ipairs(Workspace:GetDescendants()) do
        neutralizarAsiento(objeto)
end
Workspace.DescendantAdded:Connect(function(obj)
        if obj:IsA("Seat") or obj:IsA("VehicleSeat") then
                task.wait(0.1)
                neutralizarAsiento(obj)
        end
end)
player.CharacterAdded:Connect(function(char)
        local humanoid = char:WaitForChild("Humanoid")
        humanoid:GetPropertyChangedSignal("Sit"):Connect(function()
                if humanoid.Sit then
                        humanoid.Sit = false
                end
        end)
end)
end })

--// ================= MODS =================
Mods:Toggle({ Title = "Auto Get Crates", Value = false, Callback = function(state) 
  getgenv().anahtar = state
end })
Mods:Toggle({ Title = "Anti Radgoll", Value = false, Callback = function(state) 
  getgenv().antiragdoll = state
end })
Mods:Toggle({ Title = "Anti Trap", Value = false, Callback = function(state) 
  getgenv().antitrap = state
end })
Mods:Toggle({ Title = "Anti C4", Value = false, Callback = function(state)
        getgenv().antibomb = state
end })
Mods:Slider({
    Title = "Range",
    Value = { Min = 0, Max = 50, Default = 30 },
    Callback = function(state) 
      C4_RADIUS = state
    end
})
Mods:Toggle({ Title = "Anti Grenade", Value = false, Callback = function(state)
        getgenv().antigrenade = state
end })

Mods:Slider({
    Title = "Range",
    Value = { Min = 0, Max = 30, Default = 18 },
    Callback = function(state) 
      GRENADE_RADIUS = state
    end
})

Mods:Toggle({ Title = "Unlock Kamera", Value = false, Callback = function(t) 
  getgenv().unlock = t
end })
Mods:Toggle({ Title = "Auto Run", Value = false, Callback = function(t) 
  getgenv().otorun = t -- toggle buradan kontrol edilir

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")

-- Animasyon
local anim = Instance.new("Animation")
anim.AnimationId = "rbxassetid://6694500885"
local track = hum:LoadAnimation(anim)

RunService.RenderStepped:Connect(function()
        if getgenv().otorun == true and hum.MoveDirection.Magnitude > 0 then
                hum.WalkSpeed = 23
                if not track.IsPlaying then
                        track:Play()
                end
        else
                hum.WalkSpeed = 16
                if track.IsPlaying then
                        track:Stop()
                end
        end
end)
end })
Mods:Toggle({ Title = "Flip Button", Value = false, Callback = function(t) 
  game.CoreGui.DashGui.Enabled = t
end })

Mods:Toggle({ Title = "Clear Adds", Value = false, Callback = function(t)
        if t then
                game:GetService("Players").LocalPlayer.PlayerGui.ingamePurchase.Enabled = false
        else
                game:GetService("Players").LocalPlayer.PlayerGui.ingamePurchase.Enabled = true
        end
end })


Mods:Keybind({
    Title = "Flip",
    Value = "F",
    Callback = function()
      local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
local hum = char:WaitForChild("Humanoid")
local hrp = char:WaitForChild("HumanoidRootPart")
local anim = Instance.new("Animation")
anim.AnimationId = "rbxassetid://6690693371"
local track = hum:LoadAnimation(anim)
track:Play()
local targetSpeed = 106
local duration = 0.25 -- dash sÃ¼resi (kÃ¼Ã§Ã¼k = daha hÄ±zlÄ±)
local startTime = tick()
local connection
connection = RunService.Heartbeat:Connect(function()
        local alpha = math.clamp((tick() - startTime) / duration, 0, 1)
        local dir = hrp.CFrame.LookVector
        local desiredVelocity = dir * targetSpeed
        hrp.AssemblyLinearVelocity =
                hrp.AssemblyLinearVelocity:Lerp(desiredVelocity, alpha)
        if alpha >= 1 then
                connection:Disconnect()
        end
end)
    end
})

--// ================= AIMING =================
Aiming:Input({
    Title = "Prediction",
    Placeholder = "0.13",
    Callback = function(state) 
      getgenv().Prediction = state
    end
})

Aiming:Dropdown({
    Title = "Hitpart",
    Values = { "Head", "HumanoidRootPart" },
    Callback = function(state) 
       getgenv().TargetPart = state
    end
})

Aiming:Toggle({ Title = "Enable", Value = false, Callback = function(state) 
    getgenv().aimbot = state
end })
Aiming:Toggle({ Title = "Show Fov", Value = false, Callback = function(state) 
  getgenv().FOVEnabled = state
end })
Aiming:Toggle({ Title = "Lock Tool", Value = false, Callback = function(state) 
  getgenv().toool = state
end })
Aiming:Toggle({ Title = "Notify", Value = false, Callback = function(state) 
   getgenv().Notify = state
end })
Aiming:Toggle({ Title = "Highlight", Value = false, Callback = function(state) 
  getgenv().HLtarget = state
end })

Aiming:Slider({
    Title = "Locking Distance",
    Value = { Min = 50, Max = 500, Default = 200 },
    Callback = function(state) 
              getgenv().MaxDistance = state
    end
})

Aiming:Slider({
    Title = "Minigun Distance",
    Value = { Min = 10, Max = 120, Default = 50 },
    Callback = function(state) 
              MAX_DIST = state
    end
})

Aiming:Slider({
    Title = "Fov Size",
    Value = { Min = 30, Max = 350, Default = 100 },
    Callback = function(state) 
      getgenv().FOVRadius = state
    end
})


Silent:Toggle({ Title = "Enable", Value = false, Callback = function(state) 
    getgenv().otosss   = state
end })

Silent:Input({
    Title = "Prediction X",
    Placeholder = "0.13",
    Callback = function(state) 
      getgenv().predX = state
    end
})

Silent:Input({
    Title = "Prediction Y",
    Placeholder = "0.13",
    Callback = function(state) 
      getgenv().predY = state
    end
})

Silent:Input({
    Title = "Prediction Z",
    Placeholder = "0.13",
    Callback = function(state) 
      getgenv().predZ = state
    end
})

Silent:Toggle({ Title = "Show Fov", Value = false, Callback = function(state) 
    getgenv().showFov  = state
end })

Silent:Toggle({ Title = "Highligh", Value = false, Callback = function(state) 
    getgenv().hlll     = state
end })

Silent:Toggle({ Title = "Wall Check", Value = false, Callback = function(state) 
    getgenv().WallCh   = state
end })

Silent:Slider({
    Title = "Fov Size",
    Value = { Min = 30, Max = 350, Default = 100 },
    Callback = function(state) 
      getgenv().fovSize  = state
    end
})

Silent:Slider({
    Title = "Fire Rate",
    Value = { Min = 0, Max = 1, Default = 0.1 },
    Step = 0.01,
    Callback = function(state) 
      getgenv().fireRate = state
    end
})



--// ================= VISUAL =================
Visual:Toggle({ Title = "Name Esp", Value = false, Callback = function(state) 
  getgenv().name = state
end })
Visual:Toggle({ Title = "Box esp", Value = false, Callback = function(state) 
  getgenv().OnBoxESP = state 
end })
Visual:Toggle({ Title = "Tool esp", Value = false, Callback = function(state) 
  getgenv().Tool = state
end })
Visual:Toggle({ Title = "Highlight esp", Value = false, Callback = function(state) 
  getgenv().highlight = state
end })

Visual:Slider({
    Title = "Highlight fill Transparency",
    Value = { Min = 0, Max = 1, Default = 0.5 },
    Step = 0.01,
    Callback = function(state) 
      FILL_TRANSPARENCY = state
    end
})

Visual:Slider({
    Title = "Highlight Outline Transparency",
    Value = { Min = 0, Max = 1, Default = 0.5 },
    Step = 0.01,
    Callback = function(state) 
      OUTLINE_TRANSPARENCYN= state
    end
})




--// ================= STARTING =================
Starting:Button({ Title = "Start with Rocket Launcher", Callback = function() 
  game:GetService("ReplicatedStorage").events.guiEvent:FireServer("changeClass","rocket launcher","none")
end })
Starting:Button({ Title = "Start with Kick", Callback = function() 
  game:GetService("ReplicatedStorage").events.guiEvent:FireServer("changeClass","kick","none")
end })
Starting:Button({ Title = "Start with Cheetos", Callback = function() 
  game:GetService("ReplicatedStorage").events.guiEvent:FireServer("changeClass","cheetos","none")
end })
Starting:Button({ Title = "Start with Boombox", Callback = function() 
  game:GetService("ReplicatedStorage").events.guiEvent:FireServer("changeClass","Boombox","none")
end })
Starting:Button({ Title = "Start with Taser", Callback = function() 
  game:GetService("ReplicatedStorage").events.guiEvent:FireServer("changeClass","taser","none")

end })

--// ================= TELEPORT =================
Teleport:Dropdown({
    Title = "Locations",
    Values = { "Mid", "Park", "Underground Secret Room", "Secret Room", "Underground Mid", "House", "Ä°sland 1", "Ä°sland 2", "Ä°sland 3", "Ä°sland 4", "Ä°sland 5", "Ä°sland 6" },
    Callback = function(state) 
      teleport_locc = state
    end
})

Teleport:Button({
    Title = "Teleport",
    Callback = function() 
      if teleport_locc == "Mid" then
      game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2197, 164, 1368)
    elseif teleport_locc == "Park" then
  game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2213, 165, 1443)
  elseif teleport_locc == "Underground Secret Room" then
  game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2216, 119, 1266)
  elseif teleport_locc == "Secret Room" then
  game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2362, 158, 1167)
  elseif teleport_locc == "Underground Mid" then
    lp.Character.HumanoidRootPart.CFrame = CFrame.new(2196, 147, 1315)
    elseif teleport_locc == "House" then
  lp.Character.HumanoidRootPart.CFrame = CFrame.new(2040, 179, 1457)
  elseif teleport_locc == "Ä°sland 1" then
    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2552, 211, 1362)
    elseif teleport_locc == "Ä°sland 2" then
      game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2574, 188, 1206)
      elseif teleport_locc == "Ä°sland 3" then
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2331, 227, 1051)
        elseif teleport_locc == "Ä°sland 4" then
          game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(2144, 227, 991)
          elseif teleport_locc == "Ä°sland 5" then
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(1965, 227, 1064)
            elseif teleport_locc == "Ä°sland 6" then
              game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(1885, 220, 1235)
            end
    end
})

local function esp(p, cr)
        local h = cr:WaitForChild("Humanoid")
        local hrp = cr:WaitForChild("Head")

        local text = Drawing.new("Text")
        text.Visible = false
        text.Center = true
        text.Outline = false 
        text.Font = 3
        text.Size = 16.16
        text.Color = Color3.new(170,170,170)

        local conection
        local conection2
        local conection3

        local function dc()
                text.Visible = false
                text:Remove()
                if conection then
                        conection:Disconnect()
                        conection = nil 
                end
                if conection2 then
                        conection2:Disconnect()
                        conection2 = nil 
                end
                if conection3 then
                        conection3:Disconnect()
                        conection3 = nil 
                end
        end

        conection2 = cr.AncestryChanged:Connect(function(_, parent)
                if not parent then
                        dc()
                end
        end)

        conection3 = h.HealthChanged:Connect(function(v)
                if (v <= 0) or (h:GetState() == Enum.HumanoidStateType.Dead) then
                        dc()
                end
        end)

        conection = RunService.RenderStepped:Connect(function()
                if not getgenv().name then
                        text.Visible = false
                        return
                end
                local hrp_pos, hrp_onscreen = Camera:WorldToViewportPoint(hrp.Position)
                if hrp_onscreen then
                        text.Position = Vector2.new(hrp_pos.X, hrp_pos.Y - 27)
                        text.Text = "[ "..p.Name.." ]"
                        text.Visible = true
                else
                        text.Visible = false
                end
        end)
end

local function p_added(p)
        if p.Character then
                esp(p, p.Character)
        end
        p.CharacterAdded:Connect(function(cr)
                esp(p, cr)
        end)
end

for i, p in next, Players:GetPlayers() do 
        if p ~= LocalPlayer then
                p_added(p)
        end
end

Players.PlayerAdded:Connect(p_added)

local function CreateBoxESP(Target)
    local Lines = {}

    for i = 1, 12 do
        local l = Drawing.new("Line")
        l.Visible = false
        l.Color = WHITE
        l.Thickness = Box_Thickness
        Lines[i] = l
    end

    local Conn
    Conn = RunService.RenderStepped:Connect(function()

        if not getgenv().OnBoxESP then
            for _,v in pairs(Lines) do
                v.Visible = false
            end
            return
        end

        if not Target
        or Target == LocalPlayer
        or not Target.Character
        or not Target.Character:FindFirstChild("HumanoidRootPart")
        or not Target.Character:FindFirstChild("Humanoid")
        or not Target.Character:FindFirstChild("Head")
        or Target.Character.Humanoid.Health <= 0 then
            for _,v in pairs(Lines) do
                v.Visible = false
            end
            if not Players:FindFirstChild(Target.Name) then
                Conn:Disconnect()
            end
            return
        end

        local HRP = Target.Character.HumanoidRootPart
        local Head = Target.Character.Head

        local _, Visible = Camera:WorldToViewportPoint(HRP.Position)
        if not Visible then
            for _,v in pairs(Lines) do
                v.Visible = false
            end
            return
        end

        local Scale = Head.Size.Y / 2
        local Size = Vector3.new(2,3,1.5) * (Scale * 2)
        local CF = HRP.CFrame

        local function W2S(v)
            local p = Camera:WorldToViewportPoint(v)
            return Vector2.new(p.X, p.Y)
        end

        local T1 = W2S((CF * CFrame.new(-Size.X,  Size.Y, -Size.Z)).p)
        local T2 = W2S((CF * CFrame.new(-Size.X,  Size.Y,  Size.Z)).p)
        local T3 = W2S((CF * CFrame.new( Size.X,  Size.Y,  Size.Z)).p)
        local T4 = W2S((CF * CFrame.new( Size.X,  Size.Y, -Size.Z)).p)

        local B1 = W2S((CF * CFrame.new(-Size.X, -Size.Y, -Size.Z)).p)
        local B2 = W2S((CF * CFrame.new(-Size.X, -Size.Y,  Size.Z)).p)
        local B3 = W2S((CF * CFrame.new( Size.X, -Size.Y,  Size.Z)).p)
        local B4 = W2S((CF * CFrame.new( Size.X, -Size.Y, -Size.Z)).p)

        Lines[1].From, Lines[1].To = T1, T2
        Lines[2].From, Lines[2].To = T2, T3
        Lines[3].From, Lines[3].To = T3, T4
        Lines[4].From, Lines[4].To = T4, T1

        Lines[5].From, Lines[5].To = B1, B2
        Lines[6].From, Lines[6].To = B2, B3
        Lines[7].From, Lines[7].To = B3, B4
        Lines[8].From, Lines[8].To = B4, B1

        Lines[9].From,  Lines[9].To  = B1, T1
        Lines[10].From, Lines[10].To = B2, T2
        Lines[11].From, Lines[11].To = B3, T3
        Lines[12].From, Lines[12].To = B4, T4

        local Thick = Box_Thickness
        if Autothickness
        and LocalPlayer.Character
        and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local Dist = (LocalPlayer.Character.HumanoidRootPart.Position - HRP.Position).Magnitude
            Thick = math.clamp(1 / Dist * 120, 0.3, 4)
        end

        for i = 1, 12 do
            Lines[i].Thickness = Thick
            Lines[i].Color = WHITE
            Lines[i].Visible = true
        end
    end)
end

for _,P in ipairs(Players:GetPlayers()) do
    if P ~= LocalPlayer then
        CreateBoxESP(P)
    end
end

Players.PlayerAdded:Connect(function(P)
    task.wait(1)
    CreateBoxESP(P)
end)

-- =========================
-- AYAR
-- =========================


-- =========================
-- SERVÄ°SLER
-- =========================


-- =========================
-- TOOL ESP YAP
-- =========================
local function CreateToolESP(player)
    local esp = Instance.new("BillboardGui")
    esp.Name = "ToolESP"
    esp.Adornee = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    esp.Size = UDim2.new(0, 120, 0, 25)        -- Sabit boyut
    esp.StudsOffset = Vector3.new(0, -3, 0)    -- Ayak seviyesinin altÄ±
    esp.AlwaysOnTop = true
    esp.MaxDistance = 1000
    esp.Parent = ESPFolder

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)      -- Beyaz
    label.TextStrokeTransparency = 0
    label.TextScaled = false
    label.Font = Enum.Font.SourceSans         -- Daha ince font
    label.TextSize = 16                        -- KÃ¼Ã§Ã¼k ve ince
    label.Text = ""                             -- BaÅŸlangÄ±Ã§ta boÅŸ
    label.Visible = false                       -- KapalÄ±yken gÃ¶rÃ¼nmez
    label.Parent = esp

    return esp
end

-- =========================
-- ESP UYGULA
-- =========================
local function ApplyToolESP(player)
    if player == lp then return end
    if not player.Character then return end

    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local toolESP = player.Character:FindFirstChild("ToolESP") or CreateToolESP(player)
    toolESP.Adornee = hrp

    -- RenderStepped ile sÃ¼rekli gÃ¼ncelle
    RunService.RenderStepped:Connect(function()
        if not toolESP or not toolESP.TextLabel then return end

        if getgenv().Tool and player.Character then
            toolESP.TextLabel.Visible = true
            local tool = player.Character:FindFirstChildWhichIsA("Tool")
            if tool then
                toolESP.TextLabel.Text = "Tool: "..tool.Name
            else
                toolESP.TextLabel.Text = "Tool: Nothing"
            end
        else
            toolESP.TextLabel.Visible = false  -- Anahtar kapalÄ±ysa tamamen kaybolsun
        end
    end)
end

-- =========================
-- MEVCUT VE YENÄ° OYUNCULAR
-- =========================
for _, p in pairs(Players:GetPlayers()) do
    p.CharacterAdded:Connect(function(char)
        wait(0.1)
        ApplyToolESP(p)
    end)
    if p.Character then
        ApplyToolESP(p)
    end
end

Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function(char)
        wait(0.1)
        ApplyToolESP(p)
    end)
end)

local function removeHighlight(character)
    for _, obj in ipairs(CoreGui:GetChildren()) do
        if obj:IsA("Highlight") and obj.Adornee == character then
            obj:Destroy()
        end
    end
end

-- ðŸ”´ TÃœM HIGHLIGHTLARI SÄ°LER
local function clearAllHighlights()
    for _, obj in ipairs(CoreGui:GetChildren()) do
        if obj:IsA("Highlight") and obj.Name == "Enemy_ESP" then
            obj:Destroy()
        end
    end
end

local function updateHighlight(player)
    if not getgenv().highlight then
        if player.Character then
            removeHighlight(player.Character)
        end
        return
    end

    if player.Character then
        removeHighlight(player.Character)
    end

    if player ~= LocalPlayer and (player.Team ~= LocalPlayer.Team or player.Team == nil) then
        if player.Character then
            local highlight = Instance.new("Highlight")
            highlight.Name = "Enemy_ESP"
            highlight.FillColor = ESP_COLOR
            highlight.OutlineColor = ESP_COLOR
            highlight.FillTransparency = FILL_TRANSPARENCY
            highlight.OutlineTransparency = OUTLINE_TRANSPARENCY
            highlight.Adornee = player.Character
            highlight.Parent = CoreGui
        end
    end
end

local function setupPlayer(player)
    player:GetPropertyChangedSignal("Team"):Connect(function()
        updateHighlight(player)
    end)

    player.CharacterAdded:Connect(function()
        task.wait(0.3)
        updateHighlight(player)
    end)

    updateHighlight(player)
end

for _, player in ipairs(Players:GetPlayers()) do
    setupPlayer(player)
end

Players.PlayerAdded:Connect(setupPlayer)

LocalPlayer:GetPropertyChangedSignal("Team"):Connect(function()
    for _, player in ipairs(Players:GetPlayers()) do
        updateHighlight(player)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if player.Character then
        removeHighlight(player.Character)
    end
end)

-- ðŸ” RUNSERVICE LOOP (TOGGLE TAKÄ°BÄ°)
local lastState = getgenv().highlight

RunService.Heartbeat:Connect(function()
    local current = getgenv().highlight
    if current ~= lastState then
        lastState = current

        if not current then
            clearAllHighlights()
        else
            for _, player in ipairs(Players:GetPlayers()) do
                updateHighlight(player)
            end
        end
    end
end)